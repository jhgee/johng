box: debian
build:
  steps:
    - install-packages:
        packages: git
    - script:
        name: initialize git submodules
        code: |
            git submodule update --init --recursive
    - arjen/hugo-build:
        version: "0.15"
    - script:
        name: copy output directory
        code: |
          cp * -R $WERCKER_OUTPUT_DIR
deploy:
   steps:
    - install-packages:
        packages: openssh-client lftp
    # - duleorlovic/ftp-deploy:
    #     basedir: public/
    #     destination: ftp://johng.de/
    #     username: $USER
    #     password: $PASS
    - add-to-known_hosts:
        hostname: johng.de
    - add-ssh-key:
        keyname: DEPLOY
    - script:
        name: prepare lftp settings
        code: |
          mkdir -p $HOME/.lftp
          echo "set ssl:verify-certificate no" > $HOME/.lftp/rc
    - script:
        name: ftp deploy
        code: |
          lftp sftp://$USER:$PASS@johng.de/  -e "mirror  --reverse -e -R $WERCKER_ROOT/public / --verbose; bye"
